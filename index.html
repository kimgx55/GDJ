<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚽ Générateur d'Équipes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            text-align: center;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.9em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .players-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            min-height: 400px;
            padding: 10px;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            background: rgba(0,0,0,0.1);
        }

        .player-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        }

        .player-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .player-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .player-stats {
            font-size: 0.85em;
            opacity: 0.9;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .stat-badge {
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8em;
        }

        .selected-zone {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .selected-players {
            min-height: 200px;
            padding: 10px;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            background: rgba(0,0,0,0.1);
        }

        .selected-player {
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .selected-player:hover {
            background: rgba(255,255,255,0.25);
            transform: translateX(5px);
        }

        .remove-btn {
            background: rgba(245, 87, 108, 0.8);
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: #f5576c;
            transform: scale(1.1);
        }

        .generate-btn {
            width: 100%;
            padding: 20px;
            font-size: 1.3em;
            font-weight: bold;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            margin-top: 20px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(245, 87, 108, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .results-modal.active {
            display: flex;
        }

        .results-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 25px;
            padding: 40px;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        .teams-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .team-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid;
        }

        .team-card.team-a {
            border-color: #38ef7d;
        }

        .team-card.team-b {
            border-color: #4facfe;
        }

        .team-header {
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
        }

        .team-stats {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        /* Animation Stade et Cartes FIFA */
        .stadium-animation {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, #1a5f2a 0%, #0d3d1a 100%);
            z-index: 2000;
            overflow: hidden;
        }

        .stadium-animation.active {
            display: block;
        }

        .field-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(90deg, transparent 49.5%, rgba(255,255,255,0.3) 49.5%, rgba(255,255,255,0.3) 50.5%, transparent 50.5%),
                linear-gradient(0deg, transparent 49.5%, rgba(255,255,255,0.3) 49.5%, rgba(255,255,255,0.3) 50.5%, transparent 50.5%);
            background-size: 80px 80px;
            opacity: 0.2;
        }

        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border: 3px solid rgba(255,255,255,0.5);
            border-radius: 50%;
        }

        .center-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
        }

        .penalty-area {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 60px;
            border: 3px solid rgba(255,255,255,0.5);
        }

        .penalty-area.top {
            top: 0;
            border-top: none;
        }

        .penalty-area.bottom {
            bottom: 0;
            border-bottom: none;
        }

        .goal-area {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 30px;
            border: 3px solid rgba(255,255,255,0.5);
        }

        .goal-area.top {
            top: 0;
            border-top: none;
        }

        .goal-area.bottom {
            bottom: 0;
            border-bottom: none;
        }

        .team-title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            font-size: 3em;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            opacity: 0;
            animation: teamTitle 1s ease forwards;
            z-index: 100;
        }

        @keyframes teamTitle {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .reveal-glow {
            position: absolute;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(255,215,0,0) 70%);
            border-radius: 50%;
            animation: glowPulse 2s ease-in-out infinite;
            z-index: 0;
        }

        .reveal-rays {
            position: absolute;
            width: 600px;
            height: 600px;
            background: conic-gradient(
                from 0deg,
                transparent 0deg 30deg,
                rgba(255,215,0,0.3) 30deg 60deg,
                transparent 60deg 90deg,
                rgba(255,215,0,0.3) 90deg 120deg,
                transparent 120deg 150deg,
                rgba(255,215,0,0.3) 150deg 180deg,
                transparent 180deg 210deg,
                rgba(255,215,0,0.3) 210deg 240deg,
                transparent 240deg 270deg,
                rgba(255,215,0,0.3) 270deg 300deg,
                transparent 300deg 330deg,
                rgba(255,215,0,0.3) 330deg 360deg
            );
            animation: raysRotate 4s linear infinite;
            z-index: 0;
        }

        .reveal-flash {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 60%);
            opacity: 0;
            animation: flashReveal 0.5s ease-out 0.3s forwards;
            z-index: 1;
        }

        .reveal-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .category-badge {
            position: absolute;
            top: -80px;
            font-size: 4em;
            animation: badgeBounce 1s ease-out 0.5s forwards;
            opacity: 0;
            z-index: 3;
        }

        .fut-card {
            width: 350px;
            height: auto;
            position: relative;
            transform: scale(0) rotateY(180deg);
            animation: cardFlip 0.8s ease 0.8s forwards;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 100px rgba(255,215,0,0.5);
            z-index: 4;
        }

        .player-card-on-field {
            position: absolute;
            width: 120px;
            transition: all 0.5s ease;
            animation: cardEnter 1s ease-out forwards;
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.8));
        }

        .player-card-on-field img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 12px;
        }

        .player-placeholder {
            width: 120px;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            color: white;
            border: 3px solid #d4af37;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
            padding: 10px;
        }

        @keyframes cardEnter {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5) rotate(-10deg) translateX(-200px);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(0deg) translateX(0);
            }
        }

        @keyframes glowPulse {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.2); opacity: 0.9; }
        }

        @keyframes raysRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes flashReveal {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(2); }
        }

        @keyframes badgeBounce {
            0% {
                transform: translateY(0) scale(0);
                opacity: 0;
            }
            60% {
                transform: translateY(0) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translateY(0) scale(0.9);
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes cardFlip {
            0% {
                transform: scale(0) rotateY(180deg);
            }
            50% {
                transform: scale(1.1) rotateY(90deg);
            }
            100% {
                transform: scale(1) rotateY(0deg);
            }
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255,215,0,1) 0%, rgba(255,215,0,0) 70%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            animation: particleExplode 1.5s ease-out forwards;
            opacity: 0;
        }

        @keyframes particleExplode {
            0% {
                transform: translate(-50%, -50%) translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) translate(var(--tx, 0), var(--ty, 0));
                opacity: 0;
            }
        }

        #futCard img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 15px;
        }

        .skip-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            z-index: 3000;
            transition: all 0.3s ease;
        }

        .skip-button:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .teams-display {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚽ Générateur d'Équipes</h1>
        <p class="subtitle">Cliquez sur les joueurs pour créer vos équipes équilibrées</p>

        <div class="stats">
            <div class="stat-card">
                <span class="stat-number" id="totalPlayers">16</span>
                <span class="stat-label">Joueurs total</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="selectedCount">0</span>
                <span class="stat-label">Sélectionnés</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="neededCount">14</span>
                <span class="stat-label">Nécessaires</span>
            </div>
            <div class="stat-card" style="cursor: pointer;" onclick="afficherHistorique()" title="Cliquez pour voir l'historique">
                <span class="stat-number" id="historyCount">0</span>
                <span class="stat-label">📚 Matchs joués</span>
            </div>
        </div>

        <div class="main-content">
            <div class="players-section">
                <div class="section-title">
                    <span>👥</span>
                    <span>Joueurs disponibles</span>
                </div>
                <div class="players-grid" id="playersGrid"></div>
            </div>

            <div class="selected-zone">
                <div class="section-title">
                    <span>✅</span>
                    <span>Joueurs sélectionnés</span>
                </div>
                <div class="selected-players" id="selectedPlayers"></div>
                <button class="generate-btn" id="generateBtn" disabled>
                    🎲 Générer les équipes
                </button>
            </div>
        </div>
    </div>

    <div class="results-modal" id="resultsModal">
        <div class="results-container">
            <button class="close-modal" id="closeModal">×</button>
            <h2 style="text-align: center; font-size: 2.5em; margin-bottom: 30px;">🎉 Équipes Générées !</h2>
            <div id="resultsContent"></div>
        </div>
    </div>

    <!-- Animation Stade FIFA (Reprise du fichier original) -->
    <div class="stadium-animation" id="stadiumAnimation">
        <div class="field-lines"></div>
        <div class="center-circle">
            <div class="center-dot"></div>
        </div>
        <div class="penalty-area top"></div>
        <div class="penalty-area bottom"></div>
        <div class="goal-area top"></div>
        <div class="goal-area bottom"></div>
        <button class="skip-button" onclick="skipAnimation()">⏩ Passer l'animation</button>
    </div>

    <!-- Animation Carte FUT (Style FIFA) -->
    <div class="stadium-animation" id="futCardAnimation" style="background: rgba(0,0,0,0.95); z-index: 2001;">
        <div style="position: relative; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
            <div class="reveal-glow"></div>
            <div class="reveal-rays"></div>
            <div class="reveal-flash"></div>
            <div id="particlesContainer" class="reveal-particles"></div>
            <div id="categoryBadge" class="category-badge"></div>
            <div id="futCard" class="fut-card"></div>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION AJUSTÉE POUR NOUVELLES NOTES ==========
        const CONFIG = {
            TEAM_SIZE: 7,
            COMPOSITION: {"gardien": 1, "défenseur": 2, "milieu": 3, "attaquant": 1},
            
            // Seuils à 4 niveaux : Elite / Bon / Moyen / Faible
            SEUIL_ELITE: 9.0,        // Score global ≥ 9.0 = Elite 👑
            SEUIL_BON: 8.0,          // Score global ≥ 8.0 = Bon 💪
            SEUIL_MOYEN: 7.5,        // Score global ≥ 7.0 = Moyen ⭐
            // < 7.0 = Faible 📈
            
            SEUIL_FAIBLE_POSTE: 7.0, // Score poste < 7.5 = Poste faible
            
            POIDS: {
                "individualité": 0.20,              
                "condition": 0.25,                  
                "synergie": 5.0,                    
                "anti_synergie_meme_poste": 4.0,    
                // repetition: retiré - on rejette au lieu de pénaliser
            },
            
            CONTRAINTES: {
                "elite_min": 0,              
                "elite_max": 3,
                "bon_min": 1,                // Au moins 1 bon joueur
                "bon_max": 4,                // Max 4 bons joueurs
                "faible_min": 0,             
                "faible_max": 4,             
                "individualite_min": 28,     
                "individualite_max": 65,     
                "condition_min": 30,         
            },
            
            COMPLEMENTARITE: {
                "max_faibles_par_ligne": 2,        
                "max_faibles_par_poste": 2,        
                "min_score_ligne_defense": 10,     
                "min_score_ligne_milieu": 14,      
                "bonus_ligne_equilibree": 2.0,
                "seuil_repetition_max": 5,         // NOUVEAU : Max 5 joueurs en commun avec historique
                "seuil_repetition_recent": 4,      // NOUVEAU : Max 4 joueurs en commun avec dernier match    
            }
        };

        // ========== DONNÉES DES JOUEURS (NOUVELLES NOTES) ==========
        const joueursData = [
            {"nom": "Younes", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [8.35, 4.50, 7.58, 5.85], "individualité": 7.77, "condition": 6.92},
            {"nom": "Racim", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [5.67, 7.75, 6.31, 8.38], "individualité": 6.67, "condition": 6.42},
            {"nom": "Liamine", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [6.81, 6.54, 5.77, 7.15], "individualité": 6.04, "condition": 6.38},
            {"nom": "Khaled", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [6.38, 4.38, 4.92, 5.15], "individualité": 5.04, "condition": 6.62},
            {"nom": "Moncef", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [6.00, 6.08, 6.54, 6.92], "individualité": 6.69, "condition": 6.69},
            {"nom": "Zaki", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [7.19, 4.85, 6.81, 5.15], "individualité": 6.96, "condition": 6.62},
            {"nom": "Amine", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [7.25, 5.00, 6.67, 5.54], "individualité": 7.04, "condition": 6.21},
            {"nom": "Djemel", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [5.96, 4.33, 6.25, 5.63], "individualité": 5.75, "condition": 6.58},
            {"nom": "Besboussa", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [5.50, 4.08, 6.42, 5.08], "individualité": 6.27, "condition": 5.35},
            {"nom": "Sidahmed", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [4.33, 8.88, 4.67, 5.71], "individualité": 4.88, "condition": 5.21},
            {"nom": "Hamza", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [6.65, 1.88, 7.33, 5.04], "individualité": 7.38, "condition": 5.58},
            {"nom": "Hocine", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [5.54, 4.65, 4.50, 4.92], "individualité": 4.35, "condition": 6.81},
            {"nom": "Amir (invité)", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [6.43, 4.79, 4.57, 4.86], "individualité": 4.71, "condition": 4.64},
            {"nom": "Walid", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [5.00, 4.35, 5.85, 5.62], "individualité": 5.85, "condition": 5.58},
            {"nom": "Kimoune", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [4.42, 4.67, 4.67, 5.67], "individualité": 4.67, "condition": 5.33},
            {"nom": "Sofiane", "poste": ["attaquant", "gardien", "milieu", "défenseur"], "niveau": [4.00, 4.85, 4.35, 6.88], "individualité": 4.46, "condition": 5.85}
        ];

        const synergies = [
            ["Racim", "Younes"],
            ["Racim", "Zaki"],
            ["Racim", "Liamine"]        


        ];

        const antiSynergies = [
            ["Kimoune", "Hocine"],
            ["Walid", "Hocine"],
            ["Walid", "Kimoune"]
        ];

        let selectedPlayers = [];
        let historique = [];
        let animationSkipped = false;

        // ========== GESTION HISTORIQUE AVEC LOCALSTORAGE ==========
        function chargerHistorique() {
            try {
                const stored = localStorage.getItem('team_generator_historique');
                if (stored) {
                    historique = JSON.parse(stored);
                    const nbMatchs = Math.floor(historique.length / 2);
                    document.getElementById('historyCount').textContent = nbMatchs;
                    console.log(`📚 Historique chargé: ${nbMatchs} match(s)`);
                }
            } catch (error) {
                console.error('Erreur chargement historique:', error);
                historique = [];
            }
        }

        function sauvegarderHistorique() {
            try {
                // Garder seulement les 5 derniers matchs (10 équipes)
                const histoLimite = historique.slice(-10);
                localStorage.setItem('team_generator_historique', JSON.stringify(histoLimite));
                const nbMatchs = Math.floor(histoLimite.length / 2);
                document.getElementById('historyCount').textContent = nbMatchs;
                console.log(`💾 Historique sauvegardé: ${nbMatchs} match(s)`);
            } catch (error) {
                console.error('Erreur sauvegarde historique:', error);
            }
        }

        function effacerHistorique() {
            if (!confirm('⚠️ Êtes-vous sûr de vouloir effacer l\'historique ?')) {
                return;
            }
            historique = [];
            localStorage.removeItem('team_generator_historique');
            document.getElementById('historyCount').textContent = '0';
            document.getElementById('resultsModal').classList.remove('active');
            alert('✅ Historique effacé !');
        }

        function afficherHistorique() {
            const modal = document.getElementById('resultsModal');
            const content = document.getElementById('resultsContent');
            
            if (historique.length === 0) {
                alert('📚 Aucun match dans l\'historique');
                return;
            }

            let historyHTML = `
                <div style="padding: 20px;">
                    <h2 style="margin-bottom: 20px;">📚 Historique des Matchs</h2>
            `;

            for (let i = 0; i < historique.length; i += 2) {
                const matchNum = Math.floor(i / 2) + 1;
                const equipeA = historique[i] || [];
                const equipeB = historique[i + 1] || [];
                
                historyHTML += `
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; margin-bottom: 15px; border-radius: 15px;">
                        <h3 style="margin-bottom: 15px;">⚽ Match ${matchNum}</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #38ef7d;">
                                <strong style="font-size: 1.2em;">🟢 Équipe A</strong>
                                <div style="margin-top: 10px;">
                                    ${equipeA.map(nom => `<div style="padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">${nom}</div>`).join('')}
                                </div>
                            </div>
                            <div style="background: rgba(79, 172, 254, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #4facfe;">
                                <strong style="font-size: 1.2em;">🔵 Équipe B</strong>
                                <div style="margin-top: 10px;">
                                    ${equipeB.map(nom => `<div style="padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">${nom}</div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            historyHTML += `
                    <button onclick="effacerHistorique()" style="
                        width: 100%;
                        padding: 15px;
                        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                        border: none;
                        border-radius: 10px;
                        color: white;
                        font-size: 1.1em;
                        font-weight: bold;
                        cursor: pointer;
                        margin-top: 20px;
                    ">🗑️ Effacer l'historique</button>
                </div>
            `;

            content.innerHTML = historyHTML;
            modal.classList.add('active');
        }

        // Exposer les fonctions globalement
        window.effacerHistorique = effacerHistorique;
        window.afficherHistorique = afficherHistorique;

        // ========== ANIMATION STADE FIFA (Reprise du fichier original) ==========
        async function playStadiumAnimation(teamA, teamB) {
            animationSkipped = false;
            const fieldAnim = document.getElementById('stadiumAnimation');
            const futCardAnim = document.getElementById('futCardAnimation');
            
            fieldAnim.classList.add('active');
            
            const positions = {
                'gardien': { top: '85%', left: '50%' },
                'défenseur': [
                    { top: '70%', left: '35%' },
                    { top: '70%', left: '65%' }
                ],
                'milieu': [
                    { top: '50%', left: '25%' },
                    { top: '50%', left: '50%' },
                    { top: '50%', left: '75%' }
                ],
                'attaquant': { top: '25%', left: '50%' }
            };
            
            async function animateTeam(team, teamName, teamColor) {
                // Réinitialiser le terrain
                const baseHTML = `
                    <div class="field-lines"></div>
                    <div class="field-midline"></div>
                    <div class="center-circle"><div class="center-dot"></div></div>
                    <div class="penalty-area top"></div>
                    <div class="penalty-area bottom"></div>
                    <div class="goal-area top"></div>
                    <div class="goal-area bottom"></div>
                `;
                fieldAnim.innerHTML = baseHTML;
                
                await sleep(1000);
                if (animationSkipped) return;
                
                // Titre de l'équipe
                const titleDiv = document.createElement('div');
                titleDiv.className = 'team-title';
                titleDiv.style.color = teamColor;
                titleDiv.style.fontSize = '4em';
                titleDiv.textContent = teamName;
                fieldAnim.appendChild(titleDiv);
                
                await sleep(2500);
                if (animationSkipped) return;
                
                titleDiv.remove();
                
                const posteCount = { 'défenseur': 0, 'milieu': 0 };
                
                for (let i = 0; i < team.joueurs.length; i++) {
                    if (animationSkipped) return;
                    
                    const [joueur, poste] = team.joueurs[i];
                    
                    // Afficher la carte FUT avec animation
                    await showFUTCard(joueur, poste);
                    await sleep(2500);
                    if (animationSkipped) return;
                    
                    futCardAnim.classList.remove('active');
                    await sleep(300);
                    
                    // Positionner sur le terrain
                    let position;
                    if (poste === 'gardien' || poste === 'attaquant') {
                        position = positions[poste];
                    } else if (poste === 'défenseur') {
                        position = positions[poste][posteCount[poste]];
                        posteCount[poste]++;
                    } else if (poste === 'milieu') {
                        position = positions[poste][posteCount[poste]];
                        posteCount[poste]++;
                    }
                    
                    if (position) {
                        const cardDiv = document.createElement('div');
                        cardDiv.className = 'player-card-on-field';
                        cardDiv.style.top = position.top;
                        cardDiv.style.left = position.left;
                        cardDiv.style.transform = 'translate(-50%, -50%)';
                        
                        // Utiliser le dossier cards/ pour les images
                        const cardImage = `cards/${joueur.nom.replace(/\s+/g, '_')}.png`;
                        
                        cardDiv.innerHTML = `<img src="${cardImage}" alt="${joueur.nom}" onerror="this.parentElement.innerHTML='<div class=\\'player-placeholder\\'>${joueur.nom.substring(0,2)}</div>'">`;
                        fieldAnim.appendChild(cardDiv);
                        
                        await sleep(600);
                    }
                }
                
                await sleep(3000);
            }
            
            // Afficher Équipe A
            await animateTeam(teamA, '🟢 ÉQUIPE A', '#38ef7d');
            if (animationSkipped) return;
            
            // Transition
            fieldAnim.innerHTML = `
                <div class="field-lines"></div>
                <div class="field-midline"></div>
                <div class="center-circle"><div class="center-dot"></div></div>
                <div class="penalty-area top"></div>
                <div class="penalty-area bottom"></div>
                <div class="goal-area top"></div>
                <div class="goal-area bottom"></div>
            `;
            await sleep(1000);
            
            // Afficher Équipe B
            await animateTeam(teamB, '🔵 ÉQUIPE B', '#4facfe');
            
            await sleep(2000);
            fieldAnim.classList.remove('active');
            futCardAnim.classList.remove('active');
        }

        async function showFUTCard(joueur, poste) {
            if (animationSkipped) return;
            
            const futCard = document.getElementById('futCard');
            const futCardAnim = document.getElementById('futCardAnimation');
            const categoryBadge = document.getElementById('categoryBadge');
            const particlesContainer = document.getElementById('particlesContainer');
            
            const categorie = categoriserJoueur(joueur);
            const categorieEmoji = categorie === 'elite' ? '👑' : 
                                  categorie === 'moyen' ? '⭐' : '📈';
            categoryBadge.textContent = categorieEmoji;
            
            // Particules d'explosion
            particlesContainer.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const angle = (i / 30) * Math.PI * 2;
                const distance = 150 + Math.random() * 100;
                particle.style.setProperty('--tx', `${Math.cos(angle) * distance}px`);
                particle.style.setProperty('--ty', `${Math.sin(angle) * distance}px`);
                particle.style.animationDelay = `${Math.random() * 0.3}s`;
                particlesContainer.appendChild(particle);
            }
            
            // Utiliser le dossier cards/ pour les images
            const cardImage = `cards/${joueur.nom.replace(/\s+/g, '_')}.png`;
            
            futCard.innerHTML = `<img src="${cardImage}" alt="${joueur.nom}" onerror="this.src='cards/default.png'">`;
            
            futCardAnim.classList.add('active');
        }

        function skipAnimation() {
            animationSkipped = true;
            document.getElementById('stadiumAnimation').classList.remove('active');
            document.getElementById('futCardAnimation').classList.remove('active');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ========== FONCTIONS DE CALCUL ==========
        function scoreJoueur(joueur, poste) {
            const idx = joueur.poste.indexOf(poste);
            if (idx === -1) return -10;
            
            const base = joueur.niveau[idx];
            const bonusIndiv = joueur.individualité * CONFIG.POIDS.individualité;
            const bonusCond = joueur.condition * CONFIG.POIDS.condition;
            
            return base + bonusIndiv + bonusCond;
        }

        function scoreGlobalJoueur(joueur) {
            const scores = joueur.poste.map(p => scoreJoueur(joueur, p));
            return scores.reduce((a, b) => a + b, 0) / scores.length;
        }

        function categoriserJoueur(joueur) {
            const score = scoreGlobalJoueur(joueur);
            if (score >= CONFIG.SEUIL_ELITE) return "elite";
            if (score >= CONFIG.SEUIL_BON) return "bon";
            if (score >= CONFIG.SEUIL_MOYEN) return "moyen";
            return "faible";
        }

        function calcSynergies(equipe) {
            let bonus = 0;
            const equipeSet = new Set(equipe.map(j => j.nom));
            for (const pair of synergies) {
                if (pair.every(j => equipeSet.has(j))) {
                    bonus += CONFIG.POIDS.synergie;
                }
            }
            return bonus;
        }

        function verifierAntiSynergies(joueursAssignes) {
            let penalty = 0;
            const parPoste = {};
            
            for (const [joueur, poste] of joueursAssignes) {
                if (!parPoste[poste]) parPoste[poste] = [];
                parPoste[poste].push(joueur.nom);
            }
            
            for (const [poste, noms] of Object.entries(parPoste)) {
                if (noms.length >= 2) {
                    for (const pair of antiSynergies) {
                        if (pair.every(j => noms.includes(j))) {
                            penalty += CONFIG.POIDS.anti_synergie_meme_poste;
                        }
                    }
                }
            }
            return penalty;
        }

        function analyserComplementarite(joueursAssignes) {
            const lignes = {"défense": [], "milieu": [], "attaque": []};
            const parPoste = {};
            
            for (const [joueur, poste] of joueursAssignes) {
                const score = scoreJoueur(joueur, poste);
                
                if (poste === "défenseur") lignes.défense.push([joueur, score]);
                else if (poste === "milieu") lignes.milieu.push([joueur, score]);
                else if (poste === "attaquant") lignes.attaque.push([joueur, score]);
                
                if (!parPoste[poste]) parPoste[poste] = [];
                parPoste[poste].push([joueur, score]);
            }
            
            let bonus = 0;
            let penalty = 0;
            
            // Vérifier max faibles par poste
            for (const [poste, joueurs] of Object.entries(parPoste)) {
                if (poste === "gardien") continue;
                const nbFaibles = joueurs.filter(([j, s]) => s <= CONFIG.SEUIL_FAIBLE_POSTE).length;
                if (nbFaibles > CONFIG.COMPLEMENTARITE.max_faibles_par_poste) {
                    penalty += 15 * nbFaibles;
                }
            }
            
            // Analyser les lignes
            for (const [ligne, joueurs] of Object.entries(lignes)) {
                if (!joueurs.length) continue;
                
                const scores = joueurs.map(([j, s]) => s);
                const totalScore = scores.reduce((a, b) => a + b, 0);
                const nbFaibles = joueurs.filter(([j, s]) => s < CONFIG.SEUIL_FAIBLE_POSTE).length;
                
                if (nbFaibles > CONFIG.COMPLEMENTARITE.max_faibles_par_ligne) {
                    penalty += 5 * (nbFaibles - CONFIG.COMPLEMENTARITE.max_faibles_par_ligne);
                }
                
                if (ligne === "défense" && totalScore < CONFIG.COMPLEMENTARITE.min_score_ligne_defense) {
                    penalty += (CONFIG.COMPLEMENTARITE.min_score_ligne_defense - totalScore) * 0.8;
                }
                
                if (ligne === "milieu" && totalScore < CONFIG.COMPLEMENTARITE.min_score_ligne_milieu) {
                    penalty += (CONFIG.COMPLEMENTARITE.min_score_ligne_milieu - totalScore) * 0.8;
                }
                
                if (scores.length >= 2) {
                    const ecart = Math.max(...scores) - Math.min(...scores);
                    if (ecart >= 1.5 && ecart <= 4.0) {
                        bonus += CONFIG.COMPLEMENTARITE.bonus_ligne_equilibree;
                    }
                }
            }
            
            return bonus - penalty;
        }

        function affecterPostesOptimaux(equipe) {
            const postesRestants = {...CONFIG.COMPOSITION};
            const joueursAssignes = [];
            const preferences = [];
            
            for (const joueur of equipe) {
                for (let i = 0; i < joueur.poste.length; i++) {
                    const poste = joueur.poste[i];
                    const score = scoreJoueur(joueur, poste);
                    preferences.push({joueur, poste, score, priorite: i});
                }
            }
            
            preferences.sort((a, b) => b.score - a.score || a.priorite - b.priorite);
            const joueursUtilises = new Set();
            
            for (const {joueur, poste} of preferences) {
                if (joueursUtilises.has(joueur.nom)) continue;
                if (postesRestants[poste] > 0) {
                    joueursAssignes.push([joueur, poste]);
                    postesRestants[poste]--;
                    joueursUtilises.add(joueur.nom);
                }
                if (joueursUtilises.size === equipe.length) break;
            }
            
            return joueursAssignes;
        }

        function verifierContraintes(equipe) {
            const nbElite = equipe.filter(j => categoriserJoueur(j) === "elite").length;
            const nbFaible = equipe.filter(j => categoriserJoueur(j) === "faible").length;
            const totalIndiv = equipe.reduce((s, j) => s + j.individualité, 0);
            const totalCond = equipe.reduce((s, j) => s + j.condition, 0);
            
            if (nbElite < CONFIG.CONTRAINTES.elite_min || nbElite > CONFIG.CONTRAINTES.elite_max) return false;
            if (nbFaible < CONFIG.CONTRAINTES.faible_min || nbFaible > CONFIG.CONTRAINTES.faible_max) return false;
            if (totalIndiv < CONFIG.CONTRAINTES.individualite_min || totalIndiv > CONFIG.CONTRAINTES.individualite_max) return false;
            if (totalCond < CONFIG.CONTRAINTES.condition_min) return false;
            
            return true;
        }

        // ========== VÉRIFIER SI UNE ÉQUIPE EST TROP RÉPÉTITIVE ==========
        function estTropRepetitive(equipeNoms, historique) {
            if (historique.length === 0) return false;
            
            const equipeSet = new Set(equipeNoms);
            
            // Vérifier le dernier match (le plus important)
            if (historique.length >= 1) {
                const dernierMatch = historique[historique.length - 1];
                const overlap = dernierMatch.filter(nom => equipeSet.has(nom)).length;
                
                // Si plus de 4 joueurs en commun avec le dernier match = REJETER
                if (overlap > CONFIG.COMPLEMENTARITE.seuil_repetition_recent) {
                    return true;
                }
            }
            
            // Vérifier les 5 derniers matchs
            const nbMatchsAVerifier = Math.min(5, Math.floor(historique.length / 2));
            for (let i = 0; i < nbMatchsAVerifier * 2; i++) {
                const oldEquipe = historique[historique.length - 1 - i];
                if (!oldEquipe) continue;
                
                const overlap = oldEquipe.filter(nom => equipeSet.has(nom)).length;
                
                // Si plus de 5 joueurs en commun avec n'importe quel match récent = REJETER
                if (overlap > CONFIG.COMPLEMENTARITE.seuil_repetition_max) {
                    return true;
                }
            }
            
            return false;
        }

        function scoreEquipe(equipe, historique = []) {
            const joueursAssignes = affecterPostesOptimaux(equipe);
            const totalScore = joueursAssignes.reduce((s, [j, p]) => s + scoreJoueur(j, p), 0);
            const synergieBonus = calcSynergies(equipe);
            const antiSynergiePenalty = verifierAntiSynergies(joueursAssignes);
            const complementariteBonus = analyserComplementarite(joueursAssignes);
            
            const nbElite = equipe.filter(j => categoriserJoueur(j) === "elite").length;
            const nbBon = equipe.filter(j => categoriserJoueur(j) === "bon").length;
            const nbMoyen = equipe.filter(j => categoriserJoueur(j) === "moyen").length;
            const nbFaible = equipe.filter(j => categoriserJoueur(j) === "faible").length;
            const totalIndiv = equipe.reduce((s, j) => s + j.individualité, 0);
            const totalCond = equipe.reduce((s, j) => s + j.condition, 0);
            
            const total = totalScore + synergieBonus + complementariteBonus - antiSynergiePenalty;
            
            return {
                score: total,
                scoreBase: totalScore,
                scoreReel: totalScore + synergieBonus + complementariteBonus - antiSynergiePenalty,
                joueurs: joueursAssignes,
                synergie: synergieBonus,
                complementarite: complementariteBonus,
                antiSynergie: antiSynergiePenalty,
                nbElite,
                nbBon,
                nbMoyen,
                nbFaible,
                individualite: totalIndiv,
                condition: totalCond
            };
        }

        function genererEquipes() {
            const selected = joueursData.filter(j => selectedPlayers.includes(j.nom));
            
            // Variables pour le suivi
            let meilleureA = null;
            let meilleureB = null;
            let meilleurDiff = Infinity;
            let tentativesValides = 0;
            let tentativesTotales = 0;
            let tentativesRejetees = 0;
            let derniereErreur = '';
            
            const maxIterations = 5000;
            
            // Diagnostic AVANT génération
            console.log('='.repeat(60));
            console.log('🎲 DIAGNOSTIC AVANT GÉNÉRATION');
            console.log('='.repeat(60));
            console.log('👥 Joueurs sélectionnés:', selected.length);
            
            selected.forEach((j, idx) => {
                const score = scoreGlobalJoueur(j);
                const cat = categoriserJoueur(j);
                console.log(`${idx+1}. ${j.nom.padEnd(20)} | Score: ${score.toFixed(2)} | ${cat.padEnd(8)} | Indiv: ${j.individualité.toFixed(2)} | Cond: ${j.condition.toFixed(2)}`);
            });
            
            const nbElite = selected.filter(j => categoriserJoueur(j) === 'elite').length;
            const nbMoyen = selected.filter(j => categoriserJoueur(j) === 'moyen').length;
            const nbFaible = selected.filter(j => categoriserJoueur(j) === 'faible').length;
            const totalIndiv = selected.reduce((s, j) => s + j.individualité, 0);
            const totalCond = selected.reduce((s, j) => s + j.condition, 0);
            
            console.log('');
            console.log('📊 STATISTIQUES GLOBALES:');
            console.log(`   Elite: ${nbElite}, Moyen: ${nbMoyen}, Faible: ${nbFaible}`);
            console.log(`   Individualité totale: ${totalIndiv.toFixed(1)}`);
            console.log(`   Condition totale: ${totalCond.toFixed(1)}`);
            console.log('');
            console.log('✅ CONTRAINTES REQUISES:');
            console.log(`   Elite par équipe: ${CONFIG.CONTRAINTES.elite_min}-${CONFIG.CONTRAINTES.elite_max}`);
            console.log(`   Faible par équipe: ${CONFIG.CONTRAINTES.faible_min}-${CONFIG.CONTRAINTES.faible_max}`);
            console.log(`   Individualité par équipe: ${CONFIG.CONTRAINTES.individualite_min}-${CONFIG.CONTRAINTES.individualite_max}`);
            console.log(`   Condition min par équipe: ${CONFIG.CONTRAINTES.condition_min}`);
            console.log('='.repeat(60));
            
            

            // Boucle de génération
            for (let i = 0; i < maxIterations * 10; i++) {
                tentativesTotales++;
                
                if (tentativesValides >= maxIterations) break;
                
                const shuffled = [...selected].sort(() => Math.random() - 0.5);
                const equipeA = shuffled.slice(0, CONFIG.TEAM_SIZE);
                const equipeB = shuffled.slice(CONFIG.TEAM_SIZE);
                
                // Vérification avec diagnostic
                const valideA = verifierContraintes(equipeA);
                const valideB = verifierContraintes(equipeB);
                
                if (!valideA || !valideB) {
                    if (tentativesTotales === 1) {
                        // Première tentative - diagnostic détaillé
                        if (!valideA) {
                            const diagA = diagnosticEquipe(equipeA, 'A');
                            derniereErreur = diagA;
                            console.log('❌ Équipe A invalide:', diagA);
                        }
                        if (!valideB) {
                            const diagB = diagnosticEquipe(equipeB, 'B');
                            derniereErreur = diagB;
                            console.log('❌ Équipe B invalide:', diagB);
                        }
                    }
                    
                    if (tentativesTotales % 10000 === 0) {
                        console.log(`⏳ ${tentativesTotales} tentatives, ${tentativesValides} valides`);
                    }
                    continue;
                }
                
                tentativesValides++;
                
                const detailsA = scoreEquipe(equipeA, historique);
                const detailsB = scoreEquipe(equipeB, historique);
                
                const diffScore = Math.abs(detailsA.scoreReel - detailsB.scoreReel);
                const diffIndiv = Math.abs(detailsA.individualite - detailsB.individualite);
                const diffCond = Math.abs(detailsA.condition - detailsB.condition);
                const diffElite = Math.abs(detailsA.nbElite - detailsB.nbElite);
                const diffBon = Math.abs(detailsA.nbBon - detailsB.nbBon);
                const diffFaible = Math.abs(detailsA.nbFaible - detailsB.nbFaible);
                
                // Formule d'équilibre (SANS pénalité de répétition)
                const diffTotale = (diffScore * 2.0) + 
                                  (diffIndiv * 0.4) + 
                                  (diffCond * 0.4) + 
                                  (diffElite * 1.5) + 
                                  (diffBon * 1.0) +
                                  (diffFaible * 1.5);
                
                if (diffTotale < meilleurDiff) {
                    meilleurDiff = diffTotale;
                    meilleureA = detailsA;
                    meilleureB = detailsB;
                }
            }
            
            console.log('');
            console.log(`✅ Génération terminée: ${tentativesValides} valides, ${tentativesRejetees} rejetées pour répétition`);
            console.log('='.repeat(60));
            
            if (!meilleureA) {
                console.error('❌ Aucune combinaison valide trouvée');
                
                const erreurMsg = `❌ AUCUNE COMBINAISON VALIDE\n\n` +
                    `Tentatives totales: ${tentativesTotales}\n` +
                    `Tentatives valides: ${tentativesValides}\n` +
                    `Tentatives rejetées (répétition): ${tentativesRejetees}\n\n` +
                    `Raison probable: ${derniereErreur}\n\n` +
                    `💡 SOLUTION:\n` +
                    `1. Sélectionnez des joueurs différents\n` +
                    `2. Ou cliquez sur "🎲 Aléatoire" ou "👑 Top 14"\n` +
                    `3. Vérifiez que vous avez une bonne répartition de niveaux\n\n` +
                    `Statistiques actuelles:\n` +
                    `- Elite: ${nbElite}, Bon: ${nbBon}, Moyen: ${nbMoyen}, Faible: ${nbFaible}\n` +
                    `- Individualité: ${totalIndiv.toFixed(1)}\n` +
                    `- Condition: ${totalCond.toFixed(1)}`;
                
                throw new Error(erreurMsg);
            }
            
            // Sauvegarder dans l'historique
            historique.push(meilleureA.joueurs.map(([j]) => j.nom));
            historique.push(meilleureB.joueurs.map(([j]) => j.nom));
            sauvegarderHistorique();
            
            return {meilleureA, meilleureB, tentativesValides};
        }

        function diagnosticEquipe(equipe, nom) {
            const nbElite = equipe.filter(j => categoriserJoueur(j) === "elite").length;
            const nbBon = equipe.filter(j => categoriserJoueur(j) === "bon").length;
            const nbFaible = equipe.filter(j => categoriserJoueur(j) === "faible").length;
            const totalIndiv = equipe.reduce((s, j) => s + j.individualité, 0);
            const totalCond = equipe.reduce((s, j) => s + j.condition, 0);
            
            let problemes = [];
            
            if (nbElite > CONFIG.CONTRAINTES.elite_max) {
                problemes.push(`Trop d'elite (${nbElite} > ${CONFIG.CONTRAINTES.elite_max})`);
            }
            if (nbBon < CONFIG.CONTRAINTES.bon_min || nbBon > CONFIG.CONTRAINTES.bon_max) {
                problemes.push(`Bons joueurs hors limites (${nbBon}, requis: ${CONFIG.CONTRAINTES.bon_min}-${CONFIG.CONTRAINTES.bon_max})`);
            }
            if (nbFaible > CONFIG.CONTRAINTES.faible_max) {
                problemes.push(`Trop de faibles (${nbFaible} > ${CONFIG.CONTRAINTES.faible_max})`);
            }
            if (totalIndiv > CONFIG.CONTRAINTES.individualite_max) {
                problemes.push(`Individualité trop haute (${totalIndiv.toFixed(1)} > ${CONFIG.CONTRAINTES.individualite_max})`);
            }
            if (totalCond < CONFIG.CONTRAINTES.condition_min) {
                problemes.push(`Condition trop basse (${totalCond.toFixed(1)} < ${CONFIG.CONTRAINTES.condition_min})`);
            }
            
            return problemes.length > 0 ? problemes.join(', ') : 'Valide';
        }

        // ========== INTERFACE ==========
        function renderPlayers() {
            const grid = document.getElementById('playersGrid');
            grid.innerHTML = '';

            joueursData.forEach(joueur => {
                if (!selectedPlayers.includes(joueur.nom)) {
                    const card = document.createElement('div');
                    card.className = 'player-card';
                    
                    const score = scoreGlobalJoueur(joueur);
                    const categorie = categoriserJoueur(joueur);
                    const emoji = categorie === 'elite' ? '👑' : categorie === 'moyen' ? '⭐' : '📈';

                    card.innerHTML = `
                        <div class="player-name">${joueur.nom}</div>
                        <div class="player-stats">
                            <span class="stat-badge">${emoji} ${categorie}</span>
                            <span class="stat-badge">💪 ${score.toFixed(2)}</span>
                            <span class="stat-badge">⚡ ${joueur.individualité.toFixed(2)}</span>
                            <span class="stat-badge">🏃 ${joueur.condition.toFixed(2)}</span>
                        </div>
                    `;

                    card.addEventListener('click', () => selectPlayer(joueur.nom));
                    grid.appendChild(card);
                }
            });
        }

        function selectPlayer(playerName) {
            if (!selectedPlayers.includes(playerName) && selectedPlayers.length < 14) {
                selectedPlayers.push(playerName);
                renderPlayers();
                renderSelectedPlayers();
                updateStats();
            }
        }

        function removePlayer(playerName) {
            selectedPlayers = selectedPlayers.filter(p => p !== playerName);
            renderPlayers();
            renderSelectedPlayers();
            updateStats();
        }

        function renderSelectedPlayers() {
            const container = document.getElementById('selectedPlayers');
            container.innerHTML = '';

            if (selectedPlayers.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.6; padding: 20px;">Cliquez sur les joueurs pour les sélectionner</p>';
            } else {
                selectedPlayers.forEach(playerName => {
                    const joueur = joueursData.find(j => j.nom === playerName);
                    const div = document.createElement('div');
                    div.className = 'selected-player';
                    div.innerHTML = `
                        <span>${joueur.nom} (${scoreGlobalJoueur(joueur).toFixed(2)})</span>
                        <button class="remove-btn">×</button>
                    `;
                    div.querySelector('.remove-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        removePlayer(playerName);
                    });
                    container.appendChild(div);
                });
            }
        }

        function updateStats() {
            document.getElementById('totalPlayers').textContent = joueursData.length;
            document.getElementById('selectedCount').textContent = selectedPlayers.length;
            document.getElementById('neededCount').textContent = 14;
            const btn = document.getElementById('generateBtn');
            btn.disabled = selectedPlayers.length !== 14;
            btn.textContent = selectedPlayers.length === 14 ? 
                '🎲 Générer les équipes' : 
                `🎲 Sélectionnez ${14 - selectedPlayers.length} joueur(s) de plus`;
        }

        function afficherResultats(teamA, teamB, tentatives) {
            const modal = document.getElementById('resultsModal');
            const content = document.getElementById('resultsContent');
            
            const formatEquipe = (details, nom, colorClass) => {
                const postes = details.joueurs.map(([j, p]) => {
                    const score = scoreJoueur(j, p);
                    
                    // Calculer la VRAIE priorité basée sur le score
                    const tousPostes = j.poste.map(poste => ({
                        poste,
                        score: scoreJoueur(j, poste)
                    })).sort((a, b) => b.score - a.score);
                    
                    const rangPoste = tousPostes.findIndex(tp => tp.poste === p) + 1;
                    
                    const emoji = score >= 8 ? '🔥' : score >= 6.5 ? '💪' : score >= 5 ? '👍' : '📉';
                    return `
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <td style="padding: 10px;"><strong>${p.toUpperCase()}</strong></td>
                            <td style="padding: 10px;">${j.nom}</td>
                            <td style="padding: 10px;">${emoji} ${score.toFixed(2)}</td>
                            <td style="padding: 10px;">${'⭐'.repeat(rangPoste)}</td>
                        </tr>
                    `;
                }).join('');

                // Analyse détaillée des postes
                const analysePostes = {};
                for (const [joueur, poste] of details.joueurs) {
                    if (!analysePostes[poste]) analysePostes[poste] = [];
                    analysePostes[poste].push({
                        nom: joueur.nom,
                        score: scoreJoueur(joueur, poste),
                        indiv: joueur.individualité,
                        cond: joueur.condition
                    });
                }

                let analyseHTML = '<div style="background: rgba(0,0,0,0.15); padding: 15px; border-radius: 10px; margin-bottom: 15px;">';
                analyseHTML += '<h4 style="margin-bottom: 10px;">🎯 Analyse par ligne:</h4>';
                
                const lignes = {
                    'Gardien': ['gardien'],
                    'Défense': ['défenseur'],
                    'Milieu': ['milieu'],
                    'Attaque': ['attaquant']
                };

                for (const [ligneName, postes] of Object.entries(lignes)) {
                    const joueursLigne = [];
                    for (const poste of postes) {
                        if (analysePostes[poste]) {
                            joueursLigne.push(...analysePostes[poste]);
                        }
                    }
                    
                    if (joueursLigne.length > 0) {
                        const scoreTotal = joueursLigne.reduce((sum, j) => sum + j.score, 0);
                        const scoreMoyen = scoreTotal / joueursLigne.length;
                        const qualite = scoreMoyen >= 7 ? '🔥 Excellent' : 
                                       scoreMoyen >= 6 ? '💪 Bon' : 
                                       scoreMoyen >= 5 ? '👍 Correct' : '⚠️ Faible';
                        
                        analyseHTML += `
                            <div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                <strong>${ligneName}:</strong> ${qualite} (${scoreMoyen.toFixed(2)})
                                <div style="font-size: 0.85em; opacity: 0.9; margin-top: 3px;">
                                    ${joueursLigne.map(j => `${j.nom} (${j.score.toFixed(1)})`).join(' • ')}
                                </div>
                            </div>
                        `;
                    }
                }
                analyseHTML += '</div>';

                return `
                    <div class="team-card ${colorClass}">
                        <div class="team-header">${colorClass === 'team-a' ? '🟢' : '🔵'} ${nom}</div>
                        
                        <div class="team-stats">
                            <div><strong>💯 Score total:</strong> ${details.score.toFixed(2)}</div>
                            <div><strong>⚽ Score réel:</strong> ${details.scoreReel.toFixed(2)}</div>
                            <div><strong>📊 Score de base:</strong> ${details.scoreBase.toFixed(2)}</div>
                            <div><strong>🤝 Bonus synergie:</strong> ${details.synergie >= 0 ? '+' : ''}${details.synergie.toFixed(2)}</div>
                            <div><strong>🔗 Complémentarité:</strong> ${details.complementarite >= 0 ? '+' : ''}${details.complementarite.toFixed(2)}</div>
                            <div><strong>⚠️ Pénalité anti-syn:</strong> -${details.antiSynergie.toFixed(2)}</div>
                        </div>

                        <div style="background: rgba(0,0,0,0.15); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h4>📊 Composition:</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 8px;">
                                <div>👑 Elite: <strong>${details.nbElite}</strong></div>
                                <div>⭐ Moyens: <strong>${details.nbMoyen}</strong></div>
                                <div>📈 Faibles: <strong>${details.nbFaible}</strong></div>
                                <div>⚡ Indiv: <strong>${details.individualite.toFixed(1)}</strong></div>
                                <div>🏃 Condition: <strong>${details.condition.toFixed(1)}</strong></div>
                            </div>
                        </div>

                        ${analyseHTML}

                        <table style="width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.15); border-radius: 10px; overflow: hidden;">
                            <thead>
                                <tr style="background: rgba(0,0,0,0.3);">
                                    <th style="padding: 10px; text-align: left;">POSTE</th>
                                    <th style="padding: 10px; text-align: left;">JOUEUR</th>
                                    <th style="padding: 10px; text-align: left;">SCORE</th>
                                    <th style="padding: 10px; text-align: left;">PRIORITÉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${postes}
                            </tbody>
                        </table>
                    </div>
                `;
            };

            const diffScore = Math.abs(teamA.score - teamB.score);
            const diffReel = Math.abs(teamA.scoreReel - teamB.scoreReel);
            const diffIndiv = Math.abs(teamA.individualite - teamB.individualite);
            const diffCond = Math.abs(teamA.condition - teamB.condition);

            const equilibreEmoji = diffReel < 2.5 ? '✨ PARFAIT' : 
                                  diffReel < 4.0 ? '🎯 EXCELLENT' :
                                  diffReel < 6.0 ? '✅ BON' : 
                                  '⚠️ ACCEPTABLE';

            content.innerHTML = `
                <div class="teams-display">
                    ${formatEquipe(teamA, 'ÉQUIPE A', 'team-a')}
                    ${formatEquipe(teamB, 'ÉQUIPE B', 'team-b')}
                </div>

                <div style="text-align: center; margin-top: 30px; background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px;">
                    <h2 style="font-size: 2em; margin-bottom: 20px;">${equilibreEmoji} ÉQUILIBRE</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9em; opacity: 0.8;">Différence Score</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${diffScore.toFixed(2)}</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9em; opacity: 0.8;">Différence Réelle</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${diffReel.toFixed(2)}</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9em; opacity: 0.8;">⚡ Individualité</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${diffIndiv.toFixed(1)}</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9em; opacity: 0.8;">🏃 Condition</div>
                            <div style="font-size: 1.8em; font-weight: bold;">${diffCond.toFixed(1)}</div>
                        </div>
                    </div>
                    
                    
                    ${historique.length > 0 ? `
                    ` : ''}
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">
                        <button onclick="replayAnimation()" style="
                            padding: 15px 30px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            border: 2px solid white;
                            border-radius: 12px;
                            color: white;
                            font-size: 1.1em;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" 
                           onmouseout="this.style.transform='scale(1)'">
                            🎬 Rejouer l'animation
                        </button>
                        
                        <button onclick="document.getElementById('resultsModal').classList.remove('active'); document.getElementById('generateBtn').click();" style="
                            padding: 15px 30px;
                            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                            border: 2px solid white;
                            border-radius: 12px;
                            color: white;
                            font-size: 1.1em;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" 
                           onmouseout="this.style.transform='scale(1)'">
                            🔄 Régénérer
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        document.getElementById('generateBtn').addEventListener('click', async () => {
            try {
                const modal = document.getElementById('resultsModal');
                const content = document.getElementById('resultsContent');
                
                modal.classList.add('active');
                content.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div><p style="font-size: 1.5em;">Génération des équipes équilibrées...</p></div>';
                
                setTimeout(async () => {
                    try {
                        const {meilleureA, meilleureB, tentativesValides} = genererEquipes();
                        
                        // Sauvegarder pour rejouer l'animation
                        window.lastGeneratedTeams = {
                            teamA: meilleureA,
                            teamB: meilleureB
                        };
                        
                        // Fermer la modal
                        modal.classList.remove('active');
                        
                        // Lancer l'animation du stade
                        await playStadiumAnimation(meilleureA, meilleureB);
                        
                        // Afficher les résultats détaillés
                        afficherResultats(meilleureA, meilleureB, tentativesValides);
                    } catch (error) {
                        console.error('Erreur génération:', error);
                        content.innerHTML = `<div style="text-align: center; padding: 40px;">
                            <p style="font-size: 1.5em; color: #f5576c;">❌ ${error.message}</p>
                            <p style="margin-top: 15px; opacity: 0.8;">Essayez de sélectionner différents joueurs</p>
                            <button onclick="document.getElementById('resultsModal').classList.remove('active')" style="
                                margin-top: 20px;
                                padding: 15px 30px;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                border: none;
                                border-radius: 10px;
                                color: white;
                                font-size: 1.1em;
                                cursor: pointer;
                            ">Fermer</button>
                        </div>`;
                    }
                }, 100);
            } catch (error) {
                console.error('Erreur bouton:', error);
                alert('❌ Erreur: ' + error.message);
            }
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('resultsModal').classList.remove('active');
        });

        // Animation CSS pour le spinner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // ========== FONCTIONNALITÉS SUPPLÉMENTAIRES ==========
        
        // Bouton pour sélectionner tous les joueurs automatiquement
        function selectAllPlayers() {
            selectedPlayers = [];
            joueursData.slice(0, 14).forEach(j => selectedPlayers.push(j.nom));
            renderPlayers();
            renderSelectedPlayers();
            updateStats();
        }

        // Bouton pour désélectionner tous
        function clearAllPlayers() {
            selectedPlayers = [];
            renderPlayers();
            renderSelectedPlayers();
            updateStats();
        }

        // Sélection aléatoire de 14 joueurs
        function selectRandomPlayers() {
            const shuffled = [...joueursData].sort(() => Math.random() - 0.5);
            selectedPlayers = shuffled.slice(0, 14).map(j => j.nom);
            renderPlayers();
            renderSelectedPlayers();
            updateStats();
        }

        // Boutons d'actions rapides
        const quickActionsHTML = `
            <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                <button onclick="selectRandomPlayers()" style="
                    flex: 1;
                    padding: 10px;
                    background: rgba(255,255,255,0.2);
                    border: 2px solid rgba(255,255,255,0.3);
                    border-radius: 10px;
                    color: white;
                    cursor: pointer;
                    font-weight: bold;
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                   onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    🎲 Aléatoire
                </button>
                <button onclick="selectTopPlayers()" style="
                    flex: 1;
                    padding: 10px;
                    background: rgba(255,255,255,0.2);
                    border: 2px solid rgba(255,255,255,0.3);
                    border-radius: 10px;
                    color: white;
                    cursor: pointer;
                    font-weight: bold;
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                   onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    👑 Top 14
                </button>
                <button onclick="clearAllPlayers()" style="
                    flex: 1;
                    padding: 10px;
                    background: rgba(245, 87, 108, 0.3);
                    border: 2px solid rgba(245, 87, 108, 0.5);
                    border-radius: 10px;
                    color: white;
                    cursor: pointer;
                    font-weight: bold;
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='rgba(245, 87, 108, 0.5)'" 
                   onmouseout="this.style.background='rgba(245, 87, 108, 0.3)'">
                    🗑️ Effacer
                </button>
            </div>
        `;

        // Sélectionner les 14 meilleurs joueurs
        function selectTopPlayers() {
            const sorted = [...joueursData].sort((a, b) => scoreGlobalJoueur(b) - scoreGlobalJoueur(a));
            selectedPlayers = sorted.slice(0, 14).map(j => j.nom);
            renderPlayers();
            renderSelectedPlayers();
            updateStats();
        }

        // Afficher les statistiques globales des joueurs avec détails de calcul
        function showPlayerStats() {
            const modal = document.getElementById('resultsModal');
            const content = document.getElementById('resultsContent');
            
            const sorted = [...joueursData].sort((a, b) => scoreGlobalJoueur(b) - scoreGlobalJoueur(a));
            
            let statsHTML = `
                <div style="padding: 20px;">
                    <h2 style="margin-bottom: 20px;">📊 Statistiques des Joueurs</h2>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h3>🔢 Formule de calcul du score:</h3>
                        <div style="margin-top: 10px; font-family: monospace;">
                            Score = Niveau_Poste + (Individualité × ${CONFIG.POIDS.individualité}) + (Condition × ${CONFIG.POIDS.condition})
                        </div>
                        <div style="margin-top: 10px; opacity: 0.9;">
                            <strong>Exemple Sofiane en gardien:</strong><br>
                            Score = 4.85 + (4.46 × 0.20) + (5.85 × 0.25)<br>
                            Score = 4.85 + 0.89 + 1.46 = <strong>7.20</strong>
                        </div>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.2); border-radius: 15px; overflow: hidden;">
                        <thead>
                            <tr style="background: rgba(0,0,0,0.4);">
                                <th style="padding: 12px; text-align: left;">Rang</th>
                                <th style="padding: 12px; text-align: left;">Joueur</th>
                                <th style="padding: 12px; text-align: center;">Score Global</th>
                                <th style="padding: 12px; text-align: center;">Catégorie</th>
                                <th style="padding: 12px; text-align: center;">⚡ Indiv</th>
                                <th style="padding: 12px; text-align: center;">🏃 Cond</th>
                                <th style="padding: 12px; text-align: left;">Meilleurs Postes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sorted.forEach((joueur, index) => {
                const scoreGlobal = scoreGlobalJoueur(joueur);
                const categorie = categoriserJoueur(joueur);
                const emoji = categorie === 'elite' ? '👑' : 
                             categorie === 'bon' ? '💪' :
                             categorie === 'moyen' ? '⭐' : '📈';
                
                // Calculer les 3 meilleurs postes avec VRAIE priorité basée sur le score
                const scoresPostes = joueur.poste.map((poste, idx) => ({
                    poste,
                    score: scoreJoueur(joueur, poste),
                    indexOriginal: idx
                })).sort((a, b) => b.score - a.score); // Trier par score décroissant

                // Les 3 meilleurs
                const top3 = scoresPostes.slice(0, 3).map((p, rank) => ({
                    ...p,
                    prioriteAffichee: rank + 1 // 1 = meilleur, 2 = 2ème, 3 = 3ème
                }));

                const bgColor = index % 2 === 0 ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)';
                
                statsHTML += `
                    <tr style="background: ${bgColor}; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 12px; font-weight: bold;">#${index + 1}</td>
                        <td style="padding: 12px; font-weight: bold;">${joueur.nom}</td>
                        <td style="padding: 12px; text-align: center; font-size: 1.1em; font-weight: bold;">${scoreGlobal.toFixed(2)}</td>
                        <td style="padding: 12px; text-align: center;">${emoji} ${categorie}</td>
                        <td style="padding: 12px; text-align: center;">${joueur.individualité.toFixed(2)}</td>
                        <td style="padding: 12px; text-align: center;">${joueur.condition.toFixed(2)}</td>
                        <td style="padding: 12px;">
                            ${top3.map((p, i) => `
                                <div style="margin: 2px 0;">
                                    ${i === 0 ? '🥇' : i === 1 ? '🥈' : '🥉'} 
                                    ${p.poste.toUpperCase()}: <strong>${p.score.toFixed(2)}</strong>
                                    <span style="opacity: 0.7;">${'⭐'.repeat(p.prioriteAffichee)}</span>
                                </div>
                            `).join('')}
                        </td>
                    </tr>
                `;
            });

            statsHTML += `
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 30px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
                        <h3 style="margin-bottom: 15px;">📈 Résumé</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 2em;">👑</div>
                                <div style="font-size: 1.5em; font-weight: bold;">${sorted.filter(j => categoriserJoueur(j) === 'elite').length}</div>
                                <div style="opacity: 0.8;">Elite (≥ ${CONFIG.SEUIL_ELITE})</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 2em;">⭐</div>
                                <div style="font-size: 1.5em; font-weight: bold;">${sorted.filter(j => categoriserJoueur(j) === 'moyen').length}</div>
                                <div style="opacity: 0.8;">Moyens (${CONFIG.SEUIL_FAIBLE}-${CONFIG.SEUIL_ELITE})</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 2em;">📈</div>
                                <div style="font-size: 1.5em; font-weight: bold;">${sorted.filter(j => categoriserJoueur(j) === 'faible').length}</div>
                                <div style="opacity: 0.8;">Faibles (< ${CONFIG.SEUIL_FAIBLE})</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 2em;">💪</div>
                                <div style="font-size: 1.5em; font-weight: bold;">${(sorted.reduce((sum, j) => sum + scoreGlobalJoueur(j), 0) / sorted.length).toFixed(2)}</div>
                                <div style="opacity: 0.8;">Moyenne globale</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            content.innerHTML = statsHTML;
            modal.classList.add('active');
        }

        // Afficher l'historique des matchs
        function showHistory() {
            if (historique.length === 0) {
                alert('📚 Aucun match dans l\'historique');
                return;
            }

            const modal = document.getElementById('resultsModal');
            const content = document.getElementById('resultsContent');
            
            let historyHTML = `
                <div style="padding: 20px;">
                    <h2 style="margin-bottom: 20px;">📚 Historique des Matchs</h2>
            `;

            for (let i = 0; i < historique.length; i += 2) {
                const matchNum = Math.floor(i / 2) + 1;
                const equipeA = historique[i] || [];
                const equipeB = historique[i + 1] || [];
                
                historyHTML += `
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; margin-bottom: 15px; border-radius: 15px;">
                        <h3 style="margin-bottom: 15px;">⚽ Match ${matchNum}</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #38ef7d;">
                                <strong style="font-size: 1.2em;">🟢 Équipe A</strong>
                                <div style="margin-top: 10px;">
                                    ${equipeA.map(nom => `<div style="padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">${nom}</div>`).join('')}
                                </div>
                            </div>
                            <div style="background: rgba(79, 172, 254, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #4facfe;">
                                <strong style="font-size: 1.2em;">🔵 Équipe B</strong>
                                <div style="margin-top: 10px;">
                                    ${equipeB.map(nom => `<div style="padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">${nom}</div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            historyHTML += `
                    <button onclick="clearHistory()" style="
                        width: 100%;
                        padding: 15px;
                        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                        border: none;
                        border-radius: 10px;
                        color: white;
                        font-size: 1.1em;
                        font-weight: bold;
                        cursor: pointer;
                        margin-top: 20px;
                    ">🗑️ Effacer l'historique</button>
                </div>
            `;

            content.innerHTML = historyHTML;
            modal.classList.add('active');
        }

        // Effacer l'historique
        function clearHistory() {
            if (!confirm('⚠️ Êtes-vous sûr de vouloir effacer l\'historique ?')) {
                return;
            }
            historique = [];
            document.getElementById('historyCount').textContent = '0';
            document.getElementById('resultsModal').classList.remove('active');
            alert('✅ Historique effacé !');
        }

        // Ajouter les fonctions au scope global
        window.selectRandomPlayers = selectRandomPlayers;
        window.selectTopPlayers = selectTopPlayers;
        window.clearAllPlayers = clearAllPlayers;
        window.showPlayerStats = showPlayerStats;
        window.showHistory = showHistory;
        window.clearHistory = clearHistory;

        // Ajouter les boutons d'actions rapides à la zone de sélection
        document.querySelector('.selected-zone').insertAdjacentHTML('beforeend', quickActionsHTML);

        // Ajouter un bouton "Voir Stats" dans le header
        const statsButton = document.createElement('div');
        statsButton.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        `;
        statsButton.innerHTML = `
            <button onclick="showPlayerStats()" style="
                padding: 12px 24px;
                background: rgba(255,255,255,0.2);
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255,255,255,0.3);
                border-radius: 12px;
                color: white;
                cursor: pointer;
                font-weight: bold;
                font-size: 1em;
                transition: all 0.3s ease;
            " onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
               onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                📊 Statistiques
            </button>
            <button onclick="afficherHistorique()" style="
                padding: 12px 24px;
                background: rgba(255,255,255,0.2);
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255,255,255,0.3);
                border-radius: 12px;
                color: white;
                cursor: pointer;
                font-weight: bold;
                font-size: 1em;
                transition: all 0.3s ease;
            " onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
               onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                📚 Historique
            </button>
        `;
        document.body.appendChild(statsButton);

        // Initialisation
        chargerHistorique();
        renderPlayers();
        updateStats();
        
        console.log('✅ Générateur d\'équipes initialisé');
        console.log('📊 Paramètres:', CONFIG);
        console.log('👥 Joueurs chargés:', joueursData.length);
        console.log('📚 Matchs en historique:', Math.floor(historique.length / 2));
    </script>
</body>
</html>